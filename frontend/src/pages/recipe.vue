<template>
  <Layout>
    <main class='min-h-screen max-w-5xl mx-auto px-2 py-4 pt-24 grid gap-2' @click="selectStep(null)">
      <div class="flex justify-between">
        <RouterLink :to='`edit/${this.$route.params.id}`'
          class='w-9 h-9 rounded-full flex items-center justify-center transition duration-300 dark:bg-zinc-600 bg-zinc-400'>
            <svg class="w-5 h-5 dark:fill-white fill-black" viewBox="0 0 512 512"><path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160L0 416c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-96c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 64z"/></svg>
        </RouterLink>
        <button @click="deleteRecipe"
          class='w-9 h-9 rounded-full flex items-center justify-center transition duration-300 dark:bg-zinc-600 bg-zinc-400'>
            <svg class="w-5 h-5 dark:fill-white fill-black" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
      </button>
      </div>
      <section class="flex flex-col items-center gap-4" >
        <h1 class="text-4xl font-bold dark:text-white">{{ recipe.name }}</h1>

        <div class="flex items-center justify-center gap-4">
          <div class="grid justify-items-center gap-1.5">
            <img src="/images/levels.svg" alt="difficulty" class="w-8">
            <p class="text-sm mb-0 dark:text-white">{{ getDifficulty }}</p>
          </div>
          <div class="grid justify-items-center gap-1.5">
            <img src="/images/wallet.svg" alt="cost" class="w-8">
            <p class="text-sm mb-0 dark:text-white">{{ getCost }}</p>
          </div>
        </div>

        <img :src="imageUrl" :alt="recipe.name" 
          class="max-w-[650px] max-h-[350px] w-full rounded md:w-auto shadow-md">

        <table class="w-full max-w-xl bg-zinc-400 dark:bg-zinc-600 table-fixed dark:text-white">
          <tr>
            <th class="bg-zinc-500 dark:bg-zinc-700 border-b border-zinc-400 dark:border-zinc-600 py-1 px-4">
              Előkészítés
            </th>
            <th class="bg-zinc-500 dark:bg-zinc-700 border-b border-zinc-400 dark:border-zinc-600 py-1 px-4">
              Elkészítés
            </th>
            <th class="bg-zinc-500 dark:bg-zinc-700 border-b border-zinc-400 dark:border-zinc-600 py-1 px-4">
              Összesen
            </th>
          </tr>
          <tr class="text-center">
            <td class="py-1 px-4">{{ formatTime(recipe.prepare_time) }}</td>
            <td class="py-1 px-4">{{ formatTime(recipe.cooking_time) }}</td>
            <td class="py-1 px-4">{{ formatTime(getTotalTime) }}</td>
          </tr>
        </table>
      </section>

      <section class="grid grid-cols-1 text-lg">
        <div class="grid grid-cols-[1fr_auto_auto_auto_auto] items-center gap-2 border-t border-zinc-600 dark:border-white py-2">
          <h2 class="font-bold mb-0 dark:text-white">Hozzávalók</h2>
          <button @click="decreaseServings" 
            class="w-9 h-9 flex items-center justify-center disabled:opacity-50"
            :disabled="servings <= 1">
            <div class="w-5 h-1 bg-black dark:bg-white rounded-full"></div>
          </button>
            <input type="number" v-model="servings" min="1" max="99"
            class="w-7 p-1 border border-black text-right [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none">
          <p class="mb-0 font-bold dark:text-white">adag</p>
          <button @click="increaseServings"
            class="w-9 h-9 flex items-center justify-center"
            :disabled="servings >= 99">
            <div class="relative">
              <div class="w-5 h-1 bg-black dark:bg-white rounded-full"></div>
              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-5 bg-black dark:bg-white rounded-full"></div>
            </div>
          </button>
        </div>
        <ul class="dark:text-white">
          <li v-for="(ingredient, i) in recipe.ingredients" :key="i">
            <span>{{ (((parseFloat(ingredient.count) || 0) * servings) / recipe.default_serving).toFixed(1) }}</span> {{ ingredient.unit }}
          </li>
        </ul>
      </section>

      <section class="py-2">
        <div class="border-t border-zinc-600 dark:border-white py-2">
          <h2 class="font-bold mb-0 dark:text-white">Elkészítés</h2>
        </div>
        <ol class="pl-2 list-none">
          <li v-for="(step, i) in recipe.steps" :key="i"
            class="p-2 text-lg mb-2 transition-all duration-200 cursor-pointer bg-zinc-300 dark:bg-zinc-900 dark:text-white hover:translate-x-2.5 hover:bg-zinc-400 dark:hover:bg-zinc-700"
            :class="{ 'translate-x-2.5 bg-zinc-400 dark:bg-zinc-700': selectedStep === i }"
            @click.stop="selectStep(i)">
            <span class="text-zinc-500 dark:text-zinc-400">{{ i + 1 }}. </span>
            {{ step.description }}
          </li>
        </ol>
      </section>
    </main>
  </Layout>
</template>

<script>
import Layout from '../layouts/Layout.vue'
import { mapActions } from 'pinia';
import { useRecipeStore } from '@stores/RecipeStore';

export default {
  components: {
    Layout
  },
  data() {
    return {
      selectedStep: null,
      recipe: {},
      servings: 1
    }
  },

  computed: {
    getDifficulty() {
      const difficulties = ['Könnyű', 'Közepes', 'Nehéz']
      return difficulties[this.recipe.difficulty - 1] || 'Ismeretlen'
    },

    getCost() {
      const costs = ['Olcsó', 'Átlagos', 'Drága']
      return costs[this.recipe.cost - 1] || 'Ismeretlen'
    },

    getTotalTime() {
      return this.recipe.cooking_time + this.recipe.prepare_time
    },

    imageUrl() {
      if (this.recipe?.image) {
        const imagePath = this.recipe.image.replace(/^\//, '');
        return `http://127.0.0.1:8080/storage/${imagePath}`;
      }
      
      switch(this.recipe?.type) {
        case 1:
          return 'data:image/svg+xml,' + encodeURIComponent('<?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="512" height="512" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><g id="nachos"><path fill="#FB6D51" d="M419.185,229.27c-5.844-4.922-12.875-8.328-20.484-10c-2.422-6.781-6.703-12.953-12.5-17.859 c-5.828-4.922-12.891-8.344-20.483-10c-2.422-6.781-6.703-12.968-12.5-17.859c-5.828-4.938-12.874-8.343-20.468-10 c-2.438-6.781-6.719-12.969-12.516-17.859c-5.828-4.938-12.875-8.344-20.484-10c-2.422-6.781-6.688-12.968-12.5-17.875 c-8.516-7.187-19.608-11.156-31.249-11.156c-11.656,0-22.75,3.969-31.265,11.156c-5.797,4.906-10.078,11.093-12.5,17.875 c-7.609,1.656-14.641,5.062-20.484,10c-5.797,4.891-10.062,11.078-12.5,17.859c-7.594,1.656-14.656,5.062-20.468,10 c-5.812,4.891-10.094,11.078-12.516,17.859c-7.593,1.656-14.64,5.078-20.484,10c-5.781,4.906-10.062,11.078-12.5,17.859 c-7.594,1.672-14.641,5.078-20.469,10c-9.421,7.953-14.812,19.281-14.812,31.078c0,11.805,5.391,23.116,14.812,31.054 c8.516,7.219,19.609,11.188,31.25,11.188h263.854c11.641,0,22.734-3.969,31.266-11.188c9.406-7.938,14.812-19.249,14.812-31.054 C433.997,248.551,428.591,237.223,419.185,229.27z"/><g><polygon fill="#FECD57" points="174.486,250.895 25.536,186.208 58.113,364.15 "/></g><g><polygon fill="#F5BA45" points="128.971,174.193 89.347,318.308 257.312,250.816 "/></g><g><polygon fill="#FECD57" points="227.719,166.943 137.799,301.026 332.968,289.37 "/></g><g><polygon fill="#F5BA45" points="293.093,183.192 174.486,289.308 363.748,325.807 "/></g><g><polygon fill="#FECD57" points="308.437,179.411 339.437,339.869 468.621,211.849 "/></g><g><polygon fill="#F5BA45" points="474.386,318.058 499.011,174.443 350.951,240.613 "/></g><g><polygon fill="#ED5564" points="447.996,405.337 64.004,405.337 0.005,256.004 511.995,256.004 "/></g><polygon fill="#E5E8EC" points="29.223,324.182 44.066,309.339 6.942,272.215 "/><polygon fill="#E5E8EC" points="44.066,309.339 86.738,351.994 129.409,309.339 86.738,266.66 "/><polygon fill="#E5E8EC" points="129.409,309.339 172.064,351.994 214.735,309.339 172.064,266.66 "/><polygon fill="#E5E8EC" points="214.735,309.339 257.406,351.994 300.062,309.339 257.406,266.66 "/><polygon fill="#E5E8EC" points="300.062,309.339 342.733,351.994 385.403,309.339 342.733,266.66 "/><polygon fill="#E5E8EC" points="385.403,309.339 428.06,351.994 470.73,309.339 428.06,266.66 "/><polygon fill="#E5E8EC" points="470.73,309.339 483.62,322.213 502.933,277.121 "/><polygon fill="#E5E8EC" points="54.816,383.932 64.004,405.337 118.737,405.337 129.409,394.649 86.738,351.994 "/><polygon fill="#E5E8EC" points="129.409,394.649 140.065,405.337 204.063,405.337 214.735,394.649 172.064,351.994 "/><polygon fill="#E5E8EC" points="214.735,394.649 225.407,405.337 289.405,405.337 300.062,394.649 257.406,351.994 "/><polygon fill="#E5E8EC" points="300.062,394.649 310.733,405.337 374.731,405.337 385.403,394.649 342.733,351.994 "/><polygon fill="#E5E8EC" points="458.012,381.932 428.06,351.994 385.403,394.649 396.06,405.337 447.996,405.337 "/><polygon fill="#ED5564" points="54.816,383.932 86.738,351.994 44.066,309.339 29.223,324.182 "/><polygon fill="#ED5564" points="86.738,351.994 129.409,394.649 172.064,351.994 129.409,309.339 "/><polygon fill="#ED5564" points="172.064,351.994 214.735,394.649 257.406,351.994 214.735,309.339 "/><polygon fill="#ED5564" points="257.406,351.994 300.062,394.649 342.733,351.994 300.062,309.339 "/><polygon fill="#ED5564" points="342.733,351.994 385.403,394.649 428.06,351.994 385.403,309.339 "/><polygon fill="#ED5564" points="483.62,322.213 470.73,309.339 428.06,351.994 458.012,381.932 "/><polygon fill="#ED5564" points="3.63,264.457 6.942,272.215 44.066,309.339 86.738,266.66 76.066,256.004 12.067,256.004 "/><polygon fill="#ED5564" points="86.738,266.66 129.409,309.339 172.064,266.66 161.408,256.004 97.409,256.004 "/><polygon fill="#ED5564" points="172.064,266.66 214.735,309.339 257.406,266.66 246.734,256.004 182.736,256.004 "/><polygon fill="#ED5564" points="257.406,266.66 300.062,309.339 342.733,266.66 332.062,256.004 268.062,256.004 "/><polygon fill="#ED5564" points="342.733,266.66 385.403,309.339 428.06,266.66 417.403,256.004 353.404,256.004 "/><polygon fill="#ED5564" points="502.729,256.004 438.731,256.004 428.06,266.66 470.73,309.339 502.933,277.121 509.214,262.473 "/><g opacity="0.2"><polygon fill="#FFFFFF" points="511.292,256.004 447.278,405.337 425.966,405.337 489.948,256.004 "/></g></g></svg>');
        case 2:
          return 'data:image/svg+xml,' + encodeURIComponent('<?xml version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 511.998 511.998" style="enable-background:new 0 0 511.998 511.998;" xml:space="preserve"><path style="fill:#DFDBB2;" d="M155.658,461.9h-39.412c-11.663,0-21.118,9.455-21.118,21.118c0,11.663,9.455,21.118,21.118,21.118h279.507c11.663,0,21.118-9.455,21.118-21.118c0-11.663-9.455-21.118-21.118-21.118h-39.412c51.498-22.77,93.803-62.526,119.816-112.164H35.843C61.856,399.374,104.16,439.131,155.658,461.9z"/><path style="fill:#249189;" d="M7.604,234.624c0,41.546,10.206,80.702,28.239,115.112h440.314c18.032-34.41,28.239-73.567,28.239-115.112v-15.082H7.604V234.624z"/><rect x="7.604" y="173.407" style="fill:#DFDBB2;" width="496.796" height="46.134"/><g><rect x="92.103" y="265.465" transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 -11.3098 564.592)" style="fill:#F4521F;" width="38.346" height="38.346"/><rect x="188.585" y="265.463" transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 153.3981 632.8116)" style="fill:#F4521F;" width="38.346" height="38.346"/><rect x="285.078" y="265.468" transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 318.1183 701.0504)" style="fill:#F4521F;" width="38.346" height="38.346"/><rect x="381.561" y="265.462" transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 482.8282 769.2648)" style="fill:#F4521F;" width="38.346" height="38.346"/></g><g><path style="fill:#7A1B2E;" d="M0,165.804v46.134v15.208v7.478c0,37.117,8.142,74.026,23.627,107.509h-0.354l5.835,11.133l2.135,4.075h0.05c21.913,40.023,54.32,73.585,93.237,96.955h-8.283c-15.837,0-28.722,12.885-28.722,28.723c0,15.837,12.885,28.722,28.722,28.722h279.507c15.837,0,28.722-12.885,28.722-28.722c0-15.838-12.885-28.723-28.722-28.723h-8.284c38.919-23.37,71.324-56.933,93.238-96.955h0.049l2.089-3.986c0.015-0.029,0.031-0.058,0.047-0.087l5.834-11.133h-0.353c15.485-33.481,23.627-70.392,23.627-107.509v-7.478V211.94v-46.134H0V165.804z M354.697,454.296H217.894v15.208H320.34h36.002h39.412c7.453,0,13.515,6.063,13.515,13.516c0,7.452-6.062,13.515-13.515,13.515H116.246c-7.452,0-13.515-6.063-13.515-13.515c0-7.453,6.063-13.516,13.515-13.516h39.413h36.001h5.957v-15.208h-40.315c-45.148-20.32-83.241-54.433-108.505-96.955h414.405C437.938,399.864,399.844,433.977,354.697,454.296z M496.792,234.624c0,37.295-8.73,74.364-25.285,107.509H40.493c-16.554-33.146-25.285-70.214-25.285-107.509v-7.478h182.409h299.175v7.478H496.792z M197.616,211.939H15.208v-30.926h481.585v30.926H197.616z"/><path style="fill:#7A1B2E;" d="M81.449,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.473-18.676c-2.285-3.217-3.665-5.158-3.665-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.473-18.678c-2.285-3.218-3.665-5.16-3.665-9.872s1.379-6.654,3.665-9.872c2.732-3.847,6.473-9.115,6.473-18.678H91.587c0,4.712-1.38,6.654-3.665,9.872c-2.732,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.473,18.678c2.285,3.218,3.665,5.16,3.665,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.742,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C85.191,128.163,81.449,133.43,81.449,142.993z"/><path style="fill:#7A1B2E;" d="M135.409,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.473-18.676c-2.285-3.217-3.665-5.158-3.665-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.473-18.678c-2.285-3.218-3.665-5.16-3.665-9.872s1.379-6.654,3.665-9.872c2.732-3.847,6.473-9.115,6.473-18.678h-15.208c0,4.712-1.38,6.654-3.665,9.872c-2.732,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.473,18.678c2.285,3.218,3.665,5.16,3.665,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.742,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C139.151,128.163,135.409,133.43,135.409,142.993z"/><path style="fill:#7A1B2E;" d="M189.368,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.473-18.676c-2.285-3.217-3.665-5.158-3.665-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.473-18.678c-2.285-3.218-3.665-5.16-3.665-9.872s1.379-6.654,3.665-9.872c2.732-3.847,6.473-9.115,6.473-18.678h-15.208c0,4.712-1.38,6.654-3.665,9.872c-2.732,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.473,18.678c2.285,3.218,3.665,5.16,3.665,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.742,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C193.11,128.163,189.368,133.43,189.368,142.993z"/><path style="fill:#7A1B2E;" d="M243.327,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.474-18.676c-2.285-3.217-3.664-5.158-3.664-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.474-18.678c-2.285-3.218-3.664-5.16-3.664-9.872s1.379-6.654,3.664-9.872c2.732-3.847,6.474-9.115,6.474-18.678h-15.208c0,4.712-1.38,6.654-3.665,9.872c-2.732,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.473,18.678c2.285,3.218,3.665,5.16,3.665,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.742,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C247.069,128.163,243.327,133.43,243.327,142.993z"/><path style="fill:#7A1B2E;" d="M297.287,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.474-18.676c-2.285-3.217-3.664-5.158-3.664-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.474-18.678c-2.285-3.218-3.664-5.16-3.664-9.872s1.379-6.654,3.664-9.872c2.732-3.847,6.474-9.115,6.474-18.678h-15.208c0,4.712-1.379,6.654-3.665,9.872c-2.731,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.474,18.678c2.285,3.218,3.664,5.16,3.664,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.741,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C301.028,128.163,297.287,133.43,297.287,142.993z"/><path style="fill:#7A1B2E;" d="M351.245,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.474-18.676c-2.285-3.217-3.664-5.158-3.664-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.474-18.678c-2.285-3.218-3.664-5.16-3.664-9.872s1.379-6.654,3.664-9.872c2.732-3.847,6.474-9.115,6.474-18.678h-15.208c0,4.712-1.379,6.654-3.665,9.872c-2.731,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.474,18.678c2.285,3.218,3.664,5.16,3.664,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.741,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C354.987,128.163,351.245,133.43,351.245,142.993z"/><path style="fill:#7A1B2E;" d="M405.205,142.993h15.208c0-4.71,1.379-6.653,3.664-9.869c2.732-3.847,6.474-9.115,6.474-18.676s-3.741-14.83-6.474-18.676c-2.285-3.217-3.664-5.158-3.664-9.87c0-4.71,1.379-6.653,3.664-9.87c2.732-3.847,6.474-9.113,6.474-18.676c0-9.564-3.741-14.832-6.474-18.678c-2.285-3.218-3.664-5.16-3.664-9.872s1.379-6.654,3.664-9.872c2.732-3.847,6.474-9.115,6.474-18.678h-15.208c0,4.712-1.379,6.654-3.665,9.872c-2.731,3.847-6.473,9.115-6.473,18.677c0,9.564,3.741,14.832,6.474,18.678c2.285,3.218,3.664,5.16,3.664,9.872c0,4.71-1.379,6.653-3.664,9.869c-2.732,3.847-6.474,9.115-6.474,18.676c0,9.563,3.741,14.831,6.474,18.677c2.285,3.217,3.664,5.158,3.664,9.87c0,4.711-1.379,6.653-3.664,9.87C408.946,128.163,405.205,133.43,405.205,142.993z"/><path style="fill:#7A1B2E;" d="M73.399,284.64l37.868,37.868l37.868-37.868l-37.868-37.868L73.399,284.64z M111.268,301.001L94.906,284.64l16.361-16.361l16.362,16.361L111.268,301.001z"/><path style="fill:#7A1B2E;" d="M207.756,322.508l37.868-37.868l-37.868-37.868l-37.868,37.868L207.756,322.508z M224.117,284.64l-16.361,16.362l-16.362-16.362l16.362-16.361L224.117,284.64z"/><path style="fill:#7A1B2E;" d="M342.112,284.64l-37.869-37.868l-37.868,37.868l37.868,37.868L342.112,284.64z M304.244,268.278l16.363,16.361l-16.363,16.362l-16.362-16.362L304.244,268.278z"/><path style="fill:#7A1B2E;" d="M438.6,284.64l-37.869-37.868l-37.868,37.868l37.868,37.868L438.6,284.64z M400.732,268.278l16.363,16.361l-16.363,16.362l-16.362-16.362L400.732,268.278z"/></g><g><path style="fill:#FFFFFF;" d="M347.117,441.037l-6.15-13.909c27.491-12.155,51.596-29.666,71.644-52.049l11.329,10.147C402.439,409.227,376.593,428.004,347.117,441.037z"/><rect x="99.195" y="372.548" style="fill:#FFFFFF;" width="169.394" height="15.208"/></g></svg>');
        case 3:
          return 'data:image/svg+xml,' + encodeURIComponent('<?xml version="1.0" encoding="iso-8859-1"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><path style="fill:#E0A03D;" d="M460.091,211.694c0-112.718-91.375-204.092-204.091-204.092S51.908,98.976,51.908,211.694c-21.477,0-38.886,17.411-38.886,38.886s17.408,38.886,38.886,38.886l54.443,214.933h311.316l42.423-214.933c21.477,0,38.886-17.411,38.886-38.886S481.568,211.694,460.091,211.694z"/><polyline style="fill:#63A2AE;" points="165.152,289.465 460.091,289.465 417.668,504.398 106.351,504.398 51.908,289.465 144.879,289.465 "/><g><path style="fill:#491E17;" d="M467.579,204.694C463.87,91.196,370.385,0,255.999,0S48.13,91.196,44.421,204.694c-22.086,3.591-39,22.8-39,45.885c0,23.596,17.67,43.143,40.473,46.1L100.435,512h323.482l42.508-215.362c22.648-3.1,40.155-22.574,40.155-46.059C506.579,227.494,489.665,208.286,467.579,204.694z M460.091,281.863h-6.249h-288.69v15.204h285.69L411.42,496.796h-48.582l23.525-132.022l-14.969-2.667l-24,134.688h-83.793V322.897h-15.204v173.898h-83.793l-23.999-134.688l-14.969,2.667l23.525,132.023h-36.894L61.676,297.067h83.202v-15.204H57.825h-5.916c-17.25,0-31.284-14.034-31.284-31.284c0-17.25,14.034-31.284,31.284-31.284h7.602h155.482v-15.204H59.671C63.682,99.258,150.203,15.204,255.999,15.204s192.318,84.054,196.328,188.888H393.16v15.204h59.329h7.602c17.25,0,31.284,14.034,31.284,31.284C491.375,267.829,477.341,281.863,460.091,281.863z"/><path style="fill:#491E17;" d="M435.026,183.056c-6.709-42.092-28.315-80.704-60.839-108.726c-32.876-28.323-74.849-43.922-118.187-43.922v15.204c39.697,0,78.145,14.291,108.263,40.237c29.806,25.679,49.604,61.051,55.748,99.601L435.026,183.056z"/></g></svg>');
        case 4:
          return 'data:image/svg+xml,' + encodeURIComponent('<?xml version="1.0" encoding="utf-8"?><svg fill="#000000" width="800px" height="800px" viewBox="0 -0.5 122.88 122.88" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  style="enable-background:new 0 0 122.88 121.87" xml:space="preserve"><g><path d="M97.34,0.74c0.86-0.93,2.3-0.99,3.23-0.13c0.93,0.86,0.99,2.3,0.13,3.23L81.98,24.1l-0.03,0.04 c-2.29,2.77-3.86,5.33-4.56,7.67c-0.62,2.07-0.53,3.95,0.39,5.59c0.49,0.88,0.33,1.96-0.32,2.67l0,0l-8.89,9.62 c-0.87-0.95-1.56-1.72-2.02-2.22c-0.21-0.28-0.45-0.55-0.7-0.81l-0.02,0.02c-0.12-0.13-0.25-0.25-0.38-0.37l7.6-8.23 c-0.89-2.38-0.88-4.91-0.06-7.6c0.88-2.92,2.75-6.03,5.44-9.27c0.06-0.08,0.11-0.16,0.18-0.23L97.32,0.72L97.34,0.74L97.34,0.74z M57.13,55.01c-0.84-0.94-0.76-2.39,0.18-3.23c0.94-0.84,2.39-0.76,3.23,0.18c9.41,10.54,38.5,41.73,46.56,53.39 c10.63,15.05-5.83,19.79-11.29,14.31c-13.64-13.19-42.6-46.82-55.33-61.08c-4.58,1.94-9.03,2.24-13.5,0.96 c-4.81-1.37-9.52-4.58-14.3-9.51l-0.06-0.06c-3.64-3.84-6.49-7.63-8.55-11.38c-2.11-3.86-3.4-7.68-3.86-11.47 c-0.49-4.08-0.11-7.88,0.99-11.25c1.29-3.96,3.58-7.31,6.58-9.8c3.02-2.5,6.73-4.12,10.87-4.62c3.44-0.41,7.19-0.06,11.07,1.21 c5.37,1.75,11.63,6.1,16.82,11.68c3.83,4.11,7.11,8.92,9.06,13.87c2.03,5.16,2.65,10.5,1.02,15.5c-0.96,2.96-2.7,5.74-5.4,8.25 c-0.93,0.86-2.37,0.8-3.23-0.12c-0.86-0.93-0.8-2.37,0.12-3.23c2.09-1.95,3.43-4.08,4.16-6.33c1.26-3.87,0.73-8.16-0.93-12.38 c-1.74-4.42-4.69-8.74-8.15-12.45c-4.68-5.02-10.23-8.91-14.91-10.44c-3.21-1.04-6.28-1.34-9.09-1c-3.26,0.4-6.18,1.65-8.51,3.6 c-2.34,1.95-4.13,4.58-5.16,7.71c-0.89,2.73-1.2,5.87-0.79,9.26c0.39,3.2,1.5,6.47,3.32,9.81c1.91,3.43,4.53,6.9,7.9,10.45 l0.02,0.03c4.22,4.35,8.27,7.15,12.28,8.29c3.79,1.08,7.65,0.66,11.68-1.35c0.92-0.53,2.11-0.35,2.84,0.47 c12.42,13.91,42.63,48.92,56.01,61.89c5.81,2.37,9.03-0.55,6.25-5.7C100.7,102.43,63.5,62.17,57.13,55.01L57.13,55.01L57.13,55.01z M45.07,75.12l-29.16,31.55c-0.06,0.06-0.11,0.12-0.18,0.18c-4.26,4.6,3.28,11.3,7.96,6.82l28.32-30.65l3.04,3.45l-28.1,30.41l0,0 c-0.06,0.07-0.12,0.13-0.2,0.2c-1.68,1.41-3.37,2.33-5.08,2.71c-1.76,0.4-3.49,0.22-5.15-0.56c-0.28-0.11-0.54-0.25-0.77-0.46 l-4.03-3.73l0,0c-0.06-0.06-0.12-0.11-0.18-0.18c-1.56-1.8-2.3-3.72-2.1-5.75c0.19-1.92,1.21-3.79,3.14-5.59l29.44-31.86 L45.07,75.12L45.07,75.12z M75.63,57.46l1.73-1.87c0.86-0.93,2.31-0.99,3.23-0.13s0.99,2.3,0.13,3.23l-2,2.16L75.63,57.46 L75.63,57.46z M104.45,7.43c0.86-0.93,2.3-0.99,3.23-0.13c0.93,0.86,0.99,2.3,0.13,3.23L91.4,28.3c-0.86,0.93-2.3,0.99-3.23,0.13 c-0.93-0.86-0.99-2.3-0.13-3.23L104.45,7.43L104.45,7.43L104.45,7.43z M111.55,14c0.86-0.93,2.3-0.99,3.23-0.13 c0.93,0.86,0.99,2.3,0.13,3.23L98.51,34.86c-0.86,0.93-2.3,0.99-3.23,0.13c-0.93-0.86-0.99-2.3-0.13-3.23L111.55,14L111.55,14 L111.55,14z M118.91,20.83c0.86-0.93,2.3-0.99,3.23-0.13c0.93,0.86,0.99,2.31,0.13,3.23L103.55,44.2c-0.07,0.07-0.14,0.13-0.21,0.2 c-4.26,4.1-8.33,6.47-12.22,7.14c-4.22,0.73-8.09-0.47-11.64-3.57c-0.95-0.83-1.04-2.28-0.22-3.22c0.83-0.95,2.28-1.04,3.22-0.22 c2.45,2.14,5.07,2.98,7.84,2.49c2.98-0.51,6.26-2.48,9.84-5.93l0.02-0.02l18.71-20.25L118.91,20.83L118.91,20.83z"/></g></svg>');
      }
    }
  },

  methods: {
    ...mapActions(useRecipeStore, ['getRecipe']),
    ...mapActions(useRecipeStore, ['removeRecipe']),
    formatTime(minutes) {
      const hours = Math.floor(minutes / 60)
      const mins = minutes % 60
      return hours ? `${hours}ó ${mins}p` : `${mins}p`
    },

    increaseServings() {
      if (this.servings < 99) this.servings++
    },

    decreaseServings() {
      if (this.servings > 1) this.servings--
    },

    selectStep(index) {
      this.selectedStep = index
    },
    async deleteRecipe() {
      try {
        if (confirm("Biztosan törölni szeretné a receptet?")){
          await this.removeRecipe(this.$route.params.id)
          this.$router.push({ path: '/' })
        }
        
      } catch (error) {
        console.error('Error deleting recipe:', error);
        alert("Hiba történt, próbálja újra")
      }
    }
  },

  async mounted() {
    this.recipe = (await this.getRecipe(this.$route.params.id)).data
    this.servings = this.recipe.default_serving;
  },

  watch: {
    recipe: {
      immediate: true,
      handler(newRecipe) {
        if (newRecipe) {
          document.title = `${newRecipe.name} - Receptkönyv`;
        } else {
          document.title = 'Receptkönyv';
        }
      }
    }
  },

  beforeUnmount() {
    document.title = 'Receptkönyv';
  }
}
</script>